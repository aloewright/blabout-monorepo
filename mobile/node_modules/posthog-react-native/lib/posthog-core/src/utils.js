"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.STRING_FORMAT=exports.NEW_FLAGS_ROLLOUT_PERCENTAGE=exports.NEW_FLAGS_EXCLUDED_HASHES=void 0;exports.allSettled=allSettled;exports.assert=assert;exports.currentISOTime=currentISOTime;exports.currentTimestamp=currentTimestamp;exports.getFetch=getFetch;exports.isPromise=exports.isError=void 0;exports.isTokenInRollout=isTokenInRollout;exports.removeTrailingSlash=removeTrailingSlash;exports.retriable=retriable;exports.safeSetTimeout=safeSetTimeout;var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator"));var _asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));var NEW_FLAGS_ROLLOUT_PERCENTAGE=exports.NEW_FLAGS_ROLLOUT_PERCENTAGE=1;var NEW_FLAGS_EXCLUDED_HASHES=exports.NEW_FLAGS_EXCLUDED_HASHES=new Set(['61be3dd8','96f6df5f','8cfdba9b','bf027177','e59430a8','7fa5500b','569798e9','04809ff7','0ebc61a5','32de7f98','3beeb69a','12d34ad9','733853ec','0645bb64','5dcbee21','b1f95fa3','2189e408','82b460c2','3a8cc979','29ef8843','2cdbf767','38084b54','50f9f8de','41d0df91','5c236689','c11aedd3','ada46672','f4331ee1','42fed62a','c957462c','d62f705a','e0162666','01b3e5cf','441cef7f','bb9cafee','8f348eb0','b2553f3a','97469d7d','39f21a76','03706dcc','27d50569','307584a7','6433e92e','150c7fbb','49f57f22','3772f65b','01eb8256','3c9e9234','f853c7f7','c0ac4b67','cd609d40','10ca9b1a','8a87f11b','8e8e5216','1f6b63b3','db7943dd','79b7164c','07f78e33','2d21b6fd','952db5ee','a7d3b43f','1924dd9c','84e1b8f6','dff631b6','c5aa8a79','fa133a95','498a4508','24748755','98f3d658','21bbda67','7dbfed69','be3ec24c','fc80b8e2','75cc0998']);var STRING_FORMAT=exports.STRING_FORMAT='utf8';function assert(truthyValue,message){if(!truthyValue||typeof truthyValue!=='string'||isEmpty(truthyValue)){throw new Error(message);}}function isEmpty(truthyValue){if(truthyValue.trim().length===0){return true;}return false;}function removeTrailingSlash(url){return url===null||url===void 0?void 0:url.replace(/\/+$/,'');}function retriable(_x,_x2){return _retriable.apply(this,arguments);}function _retriable(){_retriable=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee(fn,props){var lastError,i,res;return _regenerator["default"].wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:lastError=null;i=0;case 2:if(!(i<props.retryCount+1)){_context.next=21;break;}if(!(i>0)){_context.next=6;break;}_context.next=6;return new Promise(function(r){return setTimeout(r,props.retryDelay);});case 6:_context.prev=6;_context.next=9;return fn();case 9:res=_context.sent;return _context.abrupt("return",res);case 13:_context.prev=13;_context.t0=_context["catch"](6);lastError=_context.t0;if(props.retryCheck(_context.t0)){_context.next=18;break;}throw _context.t0;case 18:i++;_context.next=2;break;case 21:throw lastError;case 22:case"end":return _context.stop();}},_callee,null,[[6,13]]);}));return _retriable.apply(this,arguments);}function currentTimestamp(){return new Date().getTime();}function currentISOTime(){return new Date().toISOString();}function safeSetTimeout(fn,timeout){var t=setTimeout(fn,timeout);(t===null||t===void 0?void 0:t.unref)&&(t===null||t===void 0?void 0:t.unref());return t;}var isPromise=exports.isPromise=function isPromise(obj){return obj&&typeof obj.then==='function';};var isError=exports.isError=function isError(x){return x instanceof Error;};function getFetch(){return typeof fetch!=='undefined'?fetch:typeof globalThis.fetch!=='undefined'?globalThis.fetch:undefined;}function fnv1a(str){var hash=0x811c9dc5;for(var i=0;i<str.length;i++){hash^=str.charCodeAt(i);hash+=(hash<<1)+(hash<<4)+(hash<<7)+(hash<<8)+(hash<<24);}return(hash>>>0).toString(16).padStart(8,'0');}function isTokenInRollout(token){var percentage=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var excludedHashes=arguments.length>2?arguments[2]:undefined;var tokenHash=fnv1a(token);if(excludedHashes===null||excludedHashes===void 0?void 0:excludedHashes.has(tokenHash)){return false;}var hashInt=parseInt(tokenHash,16);var hashFloat=hashInt/0xffffffff;return hashFloat<percentage;}function allSettled(promises){return Promise.all(promises.map(function(p){return(p!==null&&p!==void 0?p:Promise.resolve()).then(function(value){return{status:'fulfilled',value:value};},function(reason){return{status:'rejected',reason:reason};});}));}
"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.uuidv7obj=exports.uuidv7=exports.uuidv4obj=exports.uuidv4=exports.V7Generator=exports.UUID=void 0;var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));/**
 * uuidv7: An experimental implementation of the proposed UUID Version 7
 *
 * @license Apache-2.0
 * @copyright 2021-2023 LiosK
 * @packageDocumentation
 */var DIGITS="0123456789abcdef";var UUID=exports.UUID=function(){function UUID(bytes){(0,_classCallCheck2["default"])(this,UUID);this.bytes=bytes;}return(0,_createClass2["default"])(UUID,[{key:"toString",value:function toString(){var text="";for(var i=0;i<this.bytes.length;i++){text+=DIGITS.charAt(this.bytes[i]>>>4);text+=DIGITS.charAt(this.bytes[i]&0xf);if(i===3||i===5||i===7||i===9){text+="-";}}return text;}},{key:"toHex",value:function toHex(){var text="";for(var i=0;i<this.bytes.length;i++){text+=DIGITS.charAt(this.bytes[i]>>>4);text+=DIGITS.charAt(this.bytes[i]&0xf);}return text;}},{key:"toJSON",value:function toJSON(){return this.toString();}},{key:"getVariant",value:function getVariant(){var n=this.bytes[8]>>>4;if(n<0){throw new Error("unreachable");}else if(n<=7){return this.bytes.every(function(e){return e===0;})?"NIL":"VAR_0";}else if(n<=11){return"VAR_10";}else if(n<=13){return"VAR_110";}else if(n<=15){return this.bytes.every(function(e){return e===0xff;})?"MAX":"VAR_RESERVED";}else{throw new Error("unreachable");}}},{key:"getVersion",value:function getVersion(){return this.getVariant()==="VAR_10"?this.bytes[6]>>>4:undefined;}},{key:"clone",value:function clone(){return new UUID(this.bytes.slice(0));}},{key:"equals",value:function equals(other){return this.compareTo(other)===0;}},{key:"compareTo",value:function compareTo(other){for(var i=0;i<16;i++){var diff=this.bytes[i]-other.bytes[i];if(diff!==0){return Math.sign(diff);}}return 0;}}],[{key:"ofInner",value:function ofInner(bytes){if(bytes.length!==16){throw new TypeError("not 128-bit length");}else{return new UUID(bytes);}}},{key:"fromFieldsV7",value:function fromFieldsV7(unixTsMs,randA,randBHi,randBLo){if(!Number.isInteger(unixTsMs)||!Number.isInteger(randA)||!Number.isInteger(randBHi)||!Number.isInteger(randBLo)||unixTsMs<0||randA<0||randBHi<0||randBLo<0||unixTsMs>281474976710655||randA>0xfff||randBHi>1073741823||randBLo>4294967295){throw new RangeError("invalid field value");}var bytes=new Uint8Array(16);bytes[0]=unixTsMs/Math.pow(2,40);bytes[1]=unixTsMs/Math.pow(2,32);bytes[2]=unixTsMs/Math.pow(2,24);bytes[3]=unixTsMs/Math.pow(2,16);bytes[4]=unixTsMs/Math.pow(2,8);bytes[5]=unixTsMs;bytes[6]=0x70|randA>>>8;bytes[7]=randA;bytes[8]=0x80|randBHi>>>24;bytes[9]=randBHi>>>16;bytes[10]=randBHi>>>8;bytes[11]=randBHi;bytes[12]=randBLo>>>24;bytes[13]=randBLo>>>16;bytes[14]=randBLo>>>8;bytes[15]=randBLo;return new UUID(bytes);}},{key:"parse",value:function parse(uuid){var _a,_b,_c,_d;var hex=undefined;switch(uuid.length){case 32:hex=(_a=/^[0-9a-f]{32}$/i.exec(uuid))===null||_a===void 0?void 0:_a[0];break;case 36:hex=(_b=/^([0-9a-f]{8})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{12})$/i.exec(uuid))===null||_b===void 0?void 0:_b.slice(1,6).join("");break;case 38:hex=(_c=/^\{([0-9a-f]{8})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{12})\}$/i.exec(uuid))===null||_c===void 0?void 0:_c.slice(1,6).join("");break;case 45:hex=(_d=/^urn:uuid:([0-9a-f]{8})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{12})$/i.exec(uuid))===null||_d===void 0?void 0:_d.slice(1,6).join("");break;default:break;}if(hex){var inner=new Uint8Array(16);for(var i=0;i<16;i+=4){var n=parseInt(hex.substring(2*i,2*i+8),16);inner[i+0]=n>>>24;inner[i+1]=n>>>16;inner[i+2]=n>>>8;inner[i+3]=n;}return new UUID(inner);}else{throw new SyntaxError("could not parse UUID string");}}}]);}();var V7Generator=exports.V7Generator=function(){function V7Generator(randomNumberGenerator){(0,_classCallCheck2["default"])(this,V7Generator);this.timestamp=0;this.counter=0;this.random=randomNumberGenerator!==null&&randomNumberGenerator!==void 0?randomNumberGenerator:getDefaultRandom();}return(0,_createClass2["default"])(V7Generator,[{key:"generate",value:function generate(){return this.generateOrResetCore(Date.now(),10000);}},{key:"generateOrAbort",value:function generateOrAbort(){return this.generateOrAbortCore(Date.now(),10000);}},{key:"generateOrResetCore",value:function generateOrResetCore(unixTsMs,rollbackAllowance){var value=this.generateOrAbortCore(unixTsMs,rollbackAllowance);if(value===undefined){this.timestamp=0;value=this.generateOrAbortCore(unixTsMs,rollbackAllowance);}return value;}},{key:"generateOrAbortCore",value:function generateOrAbortCore(unixTsMs,rollbackAllowance){var MAX_COUNTER=4398046511103;if(!Number.isInteger(unixTsMs)||unixTsMs<1||unixTsMs>281474976710655){throw new RangeError("`unixTsMs` must be a 48-bit positive integer");}else if(rollbackAllowance<0||rollbackAllowance>281474976710655){throw new RangeError("`rollbackAllowance` out of reasonable range");}if(unixTsMs>this.timestamp){this.timestamp=unixTsMs;this.resetCounter();}else if(unixTsMs+rollbackAllowance>=this.timestamp){this.counter++;if(this.counter>MAX_COUNTER){this.timestamp++;this.resetCounter();}}else{return undefined;}return UUID.fromFieldsV7(this.timestamp,Math.trunc(this.counter/Math.pow(2,30)),this.counter&Math.pow(2,30)-1,this.random.nextUint32());}},{key:"resetCounter",value:function resetCounter(){this.counter=this.random.nextUint32()*0x400+(this.random.nextUint32()&0x3ff);}},{key:"generateV4",value:function generateV4(){var bytes=new Uint8Array(Uint32Array.of(this.random.nextUint32(),this.random.nextUint32(),this.random.nextUint32(),this.random.nextUint32()).buffer);bytes[6]=0x40|bytes[6]>>>4;bytes[8]=0x80|bytes[8]>>>2;return UUID.ofInner(bytes);}}]);}();var getDefaultRandom=function getDefaultRandom(){return{nextUint32:function nextUint32(){return Math.trunc(Math.random()*65536)*65536+Math.trunc(Math.random()*65536);}};};var defaultGenerator;var uuidv7=exports.uuidv7=function uuidv7(){return uuidv7obj().toString();};var uuidv7obj=exports.uuidv7obj=function uuidv7obj(){return(defaultGenerator||(defaultGenerator=new V7Generator())).generate();};var uuidv4=exports.uuidv4=function uuidv4(){return uuidv4obj().toString();};var uuidv4obj=exports.uuidv4obj=function uuidv4obj(){return(defaultGenerator||(defaultGenerator=new V7Generator())).generateV4();};
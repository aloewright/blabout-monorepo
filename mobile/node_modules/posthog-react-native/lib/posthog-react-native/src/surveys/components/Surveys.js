"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");var _typeof=require("@babel/runtime/helpers/typeof");Object.defineProperty(exports,"__esModule",{value:true});exports.Questions=Questions;exports.sendSurveyShownEvent=exports.sendSurveyEvent=exports.dismissedSurveyEvent=void 0;var _extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends"));var _slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));var _defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));var _react=_interopRequireWildcard(require("react"));var _reactNative=require("react-native");var _surveysUtils=require("../surveys-utils");var _src=require("../../../../posthog-core/src");var _QuestionTypes=require("./QuestionTypes");var _usePostHog=require("../../hooks/usePostHog");var _jsxFileName="/home/runner/work/posthog-js-lite/posthog-js-lite/posthog-react-native/lib/posthog-react-native/src/surveys/components/Surveys.js",_this=void 0;function _getRequireWildcardCache(e){if("function"!=typeof WeakMap)return null;var r=new WeakMap(),t=new WeakMap();return(_getRequireWildcardCache=function _getRequireWildcardCache(e){return e?t:r;})(e);}function _interopRequireWildcard(e,r){if(!r&&e&&e.__esModule)return e;if(null===e||"object"!=_typeof(e)&&"function"!=typeof e)return{"default":e};var t=_getRequireWildcardCache(r);if(t&&t.has(e))return t.get(e);var n={__proto__:null},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if("default"!==u&&{}.hasOwnProperty.call(e,u)){var i=a?Object.getOwnPropertyDescriptor(e,u):null;i&&(i.get||i.set)?Object.defineProperty(n,u,i):n[u]=e[u];}return n["default"]=e,t&&t.set(e,n),n;}function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable;})),t.push.apply(t,o);}return t;}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach(function(r){(0,_defineProperty2["default"])(e,r,t[r]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r));});}return e;}var getSurveyInteractionProperty=function getSurveyInteractionProperty(survey,action){var surveyProperty="$survey_".concat(action,"/").concat(survey.id);if(survey.current_iteration&&survey.current_iteration>0){surveyProperty="$survey_".concat(action,"/").concat(survey.id,"/").concat(survey.current_iteration);}return surveyProperty;};var sendSurveyShownEvent=exports.sendSurveyShownEvent=function sendSurveyShownEvent(survey,posthog){posthog.capture('survey shown',_objectSpread(_objectSpread({$survey_name:survey.name,$survey_id:survey.id},(0,_src.maybeAdd)('$survey_iteration',survey.current_iteration)),(0,_src.maybeAdd)('$survey_iteration_start_date',survey.current_iteration_start_date)));};var sendSurveyEvent=exports.sendSurveyEvent=function sendSurveyEvent(){var responses=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var survey=arguments.length>1?arguments[1]:undefined;var posthog=arguments.length>2?arguments[2]:undefined;posthog.capture('survey sent',_objectSpread(_objectSpread(_objectSpread(_objectSpread({$survey_name:survey.name,$survey_id:survey.id},(0,_src.maybeAdd)('$survey_iteration',survey.current_iteration)),(0,_src.maybeAdd)('$survey_iteration_start_date',survey.current_iteration_start_date)),{},{$survey_questions:survey.questions.map(function(question){return question.question;})},responses),{},{$set:(0,_defineProperty2["default"])({},getSurveyInteractionProperty(survey,'responded'),true)}));};var dismissedSurveyEvent=exports.dismissedSurveyEvent=function dismissedSurveyEvent(survey,posthog){posthog.capture('survey dismissed',_objectSpread(_objectSpread(_objectSpread({$survey_name:survey.name,$survey_id:survey.id},(0,_src.maybeAdd)('$survey_iteration',survey.current_iteration)),(0,_src.maybeAdd)('$survey_iteration_start_date',survey.current_iteration_start_date)),{},{$set:(0,_defineProperty2["default"])({},getSurveyInteractionProperty(survey,'dismissed'),true)}));};function Questions(_ref){var survey=_ref.survey,appearance=_ref.appearance,styleOverrides=_ref.styleOverrides,onSubmit=_ref.onSubmit;var _useState=(0,_react.useState)({}),_useState2=(0,_slicedToArray2["default"])(_useState,2),questionsResponses=_useState2[0],setQuestionsResponses=_useState2[1];var _useState3=(0,_react.useState)(0),_useState4=(0,_slicedToArray2["default"])(_useState3,2),currentQuestionIndex=_useState4[0],setCurrentQuestionIndex=_useState4[1];var surveyQuestions=(0,_react.useMemo)(function(){return(0,_surveysUtils.getDisplayOrderQuestions)(survey);},[survey]);var posthog=(0,_usePostHog.usePostHog)();var onNextButtonClick=function onNextButtonClick(_ref2){var res=_ref2.res,originalQuestionIndex=_ref2.originalQuestionIndex;var responseKey=originalQuestionIndex===0?"$survey_response":"$survey_response_".concat(originalQuestionIndex);setQuestionsResponses(_objectSpread(_objectSpread({},questionsResponses),{},(0,_defineProperty2["default"])({},responseKey,res)));var isLastDisplayedQuestion=originalQuestionIndex===survey.questions.length-1;if(isLastDisplayedQuestion){sendSurveyEvent(_objectSpread(_objectSpread({},questionsResponses),{},(0,_defineProperty2["default"])({},responseKey,res)),survey,posthog);onSubmit();}else{setCurrentQuestionIndex(originalQuestionIndex+1);}};var question=surveyQuestions[currentQuestionIndex];return _react["default"].createElement(_reactNative.ScrollView,{style:[styleOverrides,{flexGrow:0}],__self:this,__source:{fileName:_jsxFileName,lineNumber:64,columnNumber:13}},getQuestionComponent({question:question,appearance:appearance,onSubmit:function onSubmit(res){return onNextButtonClick({res:res,originalQuestionIndex:question.originalQuestionIndex});}}));}var getQuestionComponent=function getQuestionComponent(props){var questionComponents={open:_QuestionTypes.OpenTextQuestion,link:_QuestionTypes.LinkQuestion,rating:_QuestionTypes.RatingQuestion,multiple_choice:_QuestionTypes.MultipleChoiceQuestion,single_choice:_QuestionTypes.MultipleChoiceQuestion};var Component=questionComponents[props.question.type];return _react["default"].createElement(Component,(0,_extends2["default"])({key:props.question.originalQuestionIndex},props,{__self:_this,__source:{fileName:_jsxFileName,lineNumber:85,columnNumber:12}}));};